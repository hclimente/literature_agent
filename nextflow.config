params {
    // ===========================
    // Backend Configuration
    // ===========================
    from                  = "journals_tsv"
    from_json_input       = "articles.json"
    from_duckdb_input     = "papers_please.duckdb"

    to                    = "articles_json"
    to_json_outdir        = "./results"

    zotero_user_id        = null
    zotero_collection_id  = null
    zotero_library_type   = "user"

    days_back             = 8

    // ===========================
    // LLM Models Configuration
    // ===========================
    batch_size                         = 10
    metadata_extraction_model          = "gemini-2.5-flash-lite"
    metadata_extraction_system_prompt = "${projectDir}/prompts/metadata_extraction.md"
    screening_model                    = "gemini-2.5-flash-lite"
    screening_system_prompt            = "${projectDir}/prompts/screening.md"
    prioritization_model               = "gemini-2.5-flash-lite"
    prioritization_system_prompt       = "${projectDir}/prompts/prioritization.md"

    // ===========================
    // Others
    // ===========================
    debug = false

}

// ===========================
// Plugins
// ===========================
plugins {
  id 'nf-schema@2.6.1'
}

// enable --help
validation {
    help {
        enabled = true
    }
}

// ===========================
// Docker Configuration
// ===========================
docker {
    enabled = true
    runOptions = "--platform linux/amd64"
}

// ===========================
// Process Configuration
// ===========================
process {
    maxForks = 10
    errorStrategy = 'terminate'  // Fail fast
    maxRetries = 0

    // Gemini API rate limiting
    withLabel: 'gemini_api' {
        maxForks = 3
        errorStrategy = {
            if (task.exitStatus == 429) { // Rate limit error
                if (task.attempt <= 10) {
                    sleep(Math.pow(2, task.attempt) * 200 as long)
                    return 'retry'
                } else {
                    return 'terminate'
                }
            } else {
                'retry'
            }
        }
        maxRetries = 10
    }
}

// ===========================
// Executor Configuration
// ===========================
executor {
    $local {
        queueSize = 50
        submitRateLimit = '10/1min'
        pollInterval = '2sec'
    }
}
